# åŸºäºè”é‚¦å­¦ä¹ çš„è‡ªåŠ¨è°ƒåˆ¶è¯†åˆ«ç³»ç»Ÿ (FL-AMR)

## 1. é¡¹ç›®ç®€ä»‹ (Introduction)

### é¡¹ç›®ç›®æ ‡
æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ª**åŸºäºè”é‚¦å­¦ä¹ çš„æ— çº¿ä¿¡å·è‡ªåŠ¨è°ƒåˆ¶è¯†åˆ«ç³»ç»Ÿ**ï¼Œç”¨äºè¯†åˆ«ä¸åŒç±»å‹çš„æ— çº¿é€šä¿¡è°ƒåˆ¶æ–¹å¼ï¼ˆå¦‚ BPSKã€QPSKã€QAM ç­‰ï¼‰ã€‚ä¸ä¼ ç»Ÿçš„é›†ä¸­å¼æœºå™¨å­¦ä¹ ä¸åŒï¼Œæœ¬é¡¹ç›®é‡‡ç”¨è”é‚¦å­¦ä¹ æ¡†æ¶ï¼Œå…è®¸å¤šä¸ªå®¢æˆ·ç«¯åœ¨ä¸å…±äº«åŸå§‹æ•°æ®çš„æƒ…å†µä¸‹ååŒè®­ç»ƒæ¨¡å‹ï¼Œç‰¹åˆ«é€‚åˆéšç§ä¿æŠ¤åœºæ™¯ã€‚

**è§£å†³çš„é—®é¢˜ï¼š**
- å¦‚ä½•åœ¨ä¿æŠ¤æ•°æ®éšç§çš„å‰æä¸‹ï¼Œè®©å¤šä¸ªé€šä¿¡èŠ‚ç‚¹ååŒè®­ç»ƒè°ƒåˆ¶è¯†åˆ«æ¨¡å‹
- å¦‚ä½•å¤„ç†ä¸åŒèŠ‚ç‚¹ä¹‹é—´æ•°æ®åˆ†å¸ƒä¸å‡è¡¡ï¼ˆNon-IIDï¼‰çš„é—®é¢˜
- å¦‚ä½•è¯„ä¼°å’Œå¯¹æ¯”ä¸åŒè”é‚¦å­¦ä¹ ç®—æ³•åœ¨è°ƒåˆ¶è¯†åˆ«ä»»åŠ¡ä¸Šçš„æ€§èƒ½

### æ ¸å¿ƒæŠ€æœ¯
- **è”é‚¦å­¦ä¹ ç®—æ³•ï¼š** 
  - **FedAvg**ï¼šè”é‚¦å¹³å‡ç®—æ³•ï¼Œå®¢æˆ·ç«¯æœ¬åœ°è®­ç»ƒåæœåŠ¡å™¨èšåˆå‚æ•°
  - **FedProx**ï¼šå¸¦è¿‘ç«¯æ­£åˆ™åŒ–çš„è”é‚¦å­¦ä¹ ï¼Œé€šè¿‡æ·»åŠ æƒ©ç½šé¡¹æé«˜æ¨¡å‹ç¨³å®šæ€§
  - **FedGen**ï¼šåŸºäºçŸ¥è¯†è’¸é¦çš„è”é‚¦å­¦ä¹ ï¼Œä½¿ç”¨ç”Ÿæˆå™¨è¿›è¡Œæ•°æ®è‡ªç”±çš„çŸ¥è¯†è½¬ç§»

- **æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼š**
  - **CNN1D_AMR**ï¼šè½»é‡çº§ä¸€ç»´å·ç§¯ç¥ç»ç½‘ç»œï¼Œä¸“é—¨ä¸º I/Q ä¿¡å·è®¾è®¡
  - **ResNet1D_AMR**ï¼šä¸€ç»´æ®‹å·®ç½‘ç»œï¼Œå…·æœ‰æ›´å¼ºçš„ç‰¹å¾æå–èƒ½åŠ›

- **æ•°æ®é›†æ”¯æŒï¼š**
  - RML2016.10aï¼ˆ11ç±»è°ƒåˆ¶ï¼Œ128é‡‡æ ·ç‚¹ï¼‰
  - RML2016.10bï¼ˆ11ç±»è°ƒåˆ¶ï¼Œ128é‡‡æ ·ç‚¹ï¼‰
  - RML2018aï¼ˆ24ç±»è°ƒåˆ¶ï¼Œ1024é‡‡æ ·ç‚¹ï¼‰
  - HisarModï¼ˆ26ç±»è°ƒåˆ¶ï¼Œ1024é‡‡æ ·ç‚¹ï¼‰

### æ¡†æ¶
æœ¬é¡¹ç›®åŸºäº **PyTorch 1.10+** å®ç°ï¼Œä½¿ç”¨ Python 3.7+ ç¼–å†™ã€‚

---

## 2. é¡¹ç›®ç»“æ„ (Project Structure)

### ç›®å½•æ ‘
```
bishe/
â”‚
â”œâ”€â”€ dataset/                          # æ•°æ®é›†ç›®å½•
â”‚   â”œâ”€â”€ data_loader.py               # æ•°æ®åŠ è½½å’Œåˆ’åˆ†æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ RML2016.10a/                 # RadioML 2016.10a æ•°æ®é›†
â”‚   â”‚   â””â”€â”€ RML2016.10a_dict.pkl    # æ•°æ®æ–‡ä»¶ï¼ˆéœ€è‡ªè¡Œä¸‹è½½ï¼‰
â”‚   â”œâ”€â”€ RML2016.10b/                 # RadioML 2016.10b æ•°æ®é›†
â”‚   â”‚   â””â”€â”€ RML2016.10b.dat         # æ•°æ®æ–‡ä»¶ï¼ˆéœ€è‡ªè¡Œä¸‹è½½ï¼‰
â”‚   â”œâ”€â”€ RML2018a/                    # RadioML 2018.01a æ•°æ®é›†
â”‚   â”‚   â””â”€â”€ GOLD_XYZ_OSC.0001_1024.hdf5  # æ•°æ®æ–‡ä»¶ï¼ˆéœ€è‡ªè¡Œä¸‹è½½ï¼‰
â”‚   â””â”€â”€ HisarMod/                    # HisarMod æ•°æ®é›†
â”‚       â”œâ”€â”€ HisarMod2019train.h5    # è®­ç»ƒé›†ï¼ˆéœ€è‡ªè¡Œä¸‹è½½ï¼‰
â”‚       â””â”€â”€ HisarMod2019test.h5     # æµ‹è¯•é›†ï¼ˆéœ€è‡ªè¡Œä¸‹è½½ï¼‰
â”‚
â”œâ”€â”€ FLAlgorithms/                     # è”é‚¦å­¦ä¹ ç®—æ³•å®ç°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ optimizers/                   # ä¼˜åŒ–å™¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ fedoptimizer.py          # è”é‚¦å­¦ä¹ ä¼˜åŒ–å™¨å°è£…
â”‚   â”‚
â”‚   â”œâ”€â”€ servers/                      # æœåŠ¡å™¨ç«¯å®ç°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ serverbase.py            # æœåŠ¡å™¨åŸºç±»
â”‚   â”‚   â”œâ”€â”€ serveravg.py             # FedAvg æœåŠ¡å™¨
â”‚   â”‚   â”œâ”€â”€ serverFedProx.py         # FedProx æœåŠ¡å™¨
â”‚   â”‚   â””â”€â”€ serverpFedGen.py         # FedGen æœåŠ¡å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ trainmodel/                   # æ¨¡å‹å®šä¹‰æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ models.py                # CNN1D å’Œ ResNet1D æ¨¡å‹
â”‚   â”‚   â””â”€â”€ generator.py             # FedGen ç”Ÿæˆå™¨æ¨¡å‹
â”‚   â”‚
â”‚   â””â”€â”€ users/                        # å®¢æˆ·ç«¯å®ç°
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ userbase.py              # å®¢æˆ·ç«¯åŸºç±»
â”‚       â”œâ”€â”€ useravg.py               # FedAvg å®¢æˆ·ç«¯
â”‚       â”œâ”€â”€ userFedProx.py           # FedProx å®¢æˆ·ç«¯
â”‚       â””â”€â”€ userpFedGen.py           # FedGen å®¢æˆ·ç«¯
â”‚
â”œâ”€â”€ utils/                            # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ model_config.py              # æ•°æ®é›†é…ç½®ä¿¡æ¯
â”‚   â”œâ”€â”€ model_utils.py               # æ¨¡å‹å‚æ•°å¤„ç†å·¥å…·
â”‚   â””â”€â”€ plot_utils.py                # ç»“æœå¯è§†åŒ–å·¥å…·
â”‚
â”œâ”€â”€ results/                          # è®­ç»ƒç»“æœè¾“å‡ºç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â”œâ”€â”€ *_metrics.csv                # è®­ç»ƒæŒ‡æ ‡æ–‡ä»¶
â”‚   â”œâ”€â”€ *_log.txt                    # è®­ç»ƒæ—¥å¿—æ–‡ä»¶
â”‚   â”œâ”€â”€ *_model.pt                   # æ¨¡å‹æƒé‡æ–‡ä»¶
â”‚   â””â”€â”€ plots/                       # å¯è§†åŒ–å›¾è¡¨ç›®å½•
â”‚       â””â”€â”€ *_comparison.png         # å¯¹æ¯”æ›²çº¿å›¾
â”‚
â”œâ”€â”€ main.py                           # ä¸»è®­ç»ƒç¨‹åºï¼ˆæ ¸å¿ƒå…¥å£ï¼‰
â”œâ”€â”€ main_plot.py                      # ç»“æœå¯è§†åŒ–ç¨‹åº
â”œâ”€â”€ requirements.txt                  # Python ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ run_example.bat                   # Windows å¿«é€Ÿç¤ºä¾‹è„šæœ¬
â””â”€â”€ run_full_experiment.bat           # Windows å®Œæ•´å®éªŒè„šæœ¬
```

---

### æ ¸å¿ƒæ–‡ä»¶åŠŸèƒ½è¯¦è§£

#### ğŸ“ dataset/ - æ•°æ®å¤„ç†æ¨¡å—

##### `data_loader.py` â­ **æœ€é‡è¦çš„æ•°æ®å¤„ç†æ–‡ä»¶**
**ä¸»è¦ä½œç”¨ï¼š** è´Ÿè´£åŠ è½½å››ç§æ•°æ®é›†ï¼Œå¹¶å®ç° IID å’Œ Non-IID æ•°æ®åˆ’åˆ†ç­–ç•¥ã€‚

**å…³é”®ç±»å’Œå‡½æ•°ï¼š**
- `SignalDataset(Dataset)`ï¼šPyTorch æ•°æ®é›†ç±»ï¼Œå°è£…ä¿¡å·æ•°æ®å’Œæ ‡ç­¾
- `load_RML2016_10a()`ï¼šåŠ è½½ RML2016.10a æ•°æ®é›†ï¼ˆpkl æ ¼å¼ï¼‰
- `load_RML2016_10b()`ï¼šåŠ è½½ RML2016.10b æ•°æ®é›†ï¼ˆdat æ ¼å¼ï¼‰
- `load_RML2018a()`ï¼šåŠ è½½ RML2018a æ•°æ®é›†ï¼ˆh5 æ ¼å¼ï¼Œéœ€è½¬ç½® I/Q ç»´åº¦ï¼‰
- `load_HisarMod()`ï¼šåŠ è½½ HisarMod æ•°æ®é›†ï¼ˆh5 æ ¼å¼ï¼‰
- `split_data_iid()`ï¼šIID åˆ’åˆ†ï¼Œéšæœºæ‰“ä¹±åå‡åŒ€åˆ†é…ç»™å®¢æˆ·ç«¯
- `split_data_non_iid_class()`ï¼šæŒ‰è°ƒåˆ¶ç±»å‹ Non-IID åˆ’åˆ†ï¼Œä½¿ç”¨ Dirichlet åˆ†å¸ƒ
- `split_data_non_iid_snr()`ï¼šæŒ‰ä¿¡å™ªæ¯”ï¼ˆSNRï¼‰èŒƒå›´ Non-IID åˆ’åˆ†
- `get_dataloaders()` â­ï¼š**ä¸»å…¥å£å‡½æ•°**ï¼Œè¿”å›è®­ç»ƒé›†å’Œæµ‹è¯•é›†çš„ DataLoader

**ä¸å…¶ä»–æ–‡ä»¶çš„äº¤äº’ï¼š**
- è¢« `main.py` è°ƒç”¨ä»¥åŠ è½½æ•°æ®
- ä½¿ç”¨ `utils/model_config.py` è·å–æ•°æ®é›†é…ç½®ä¿¡æ¯

---

#### ğŸ“ FLAlgorithms/ - è”é‚¦å­¦ä¹ æ ¸å¿ƒæ¨¡å—

##### `trainmodel/models.py` - æ·±åº¦å­¦ä¹ æ¨¡å‹å®šä¹‰
**ä¸»è¦ä½œç”¨ï¼š** å®šä¹‰ç”¨äºè‡ªåŠ¨è°ƒåˆ¶è¯†åˆ«çš„ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚

**å…³é”®ç±»ï¼š**
- `CNN1D_AMR(nn.Module)`ï¼šä¸€ç»´ CNN æ¨¡å‹
  - è¾“å…¥ï¼š`[Batch, 2, Length]`ï¼ˆ2é€šé“ä¸º I/Q ä¿¡å·ï¼ŒLength ä¸ºé‡‡æ ·ç‚¹æ•°ï¼‰
  - ç»“æ„ï¼š3ä¸ªå·ç§¯å—ï¼ˆConv1d + BatchNorm + ReLU + MaxPoolï¼‰+ 2ä¸ªå…¨è¿æ¥å±‚
  - è¾“å‡ºï¼š`[Batch, num_classes]`ï¼ˆç±»åˆ«é¢„æµ‹ logitsï¼‰
  
- `ResNet1D_AMR(nn.Module)`ï¼šä¸€ç»´æ®‹å·®ç½‘ç»œæ¨¡å‹
  - ä½¿ç”¨æ®‹å·®å—ï¼ˆResidualBlock1Dï¼‰æå‡ç‰¹å¾æå–èƒ½åŠ›
  - é€‚åˆæ›´å¤æ‚çš„è°ƒåˆ¶è¯†åˆ«ä»»åŠ¡
  
- `get_model(model_name, num_classes, signal_length)`ï¼š**æ¨¡å‹å·¥å‚å‡½æ•°**ï¼Œæ ¹æ®å‚æ•°è¿”å›æ¨¡å‹å®ä¾‹

**ä¸å…¶ä»–æ–‡ä»¶çš„äº¤äº’ï¼š**
- è¢« `main.py` è°ƒç”¨åˆ›å»ºå…¨å±€æ¨¡å‹
- è¢«å„ä¸ª User ç±»è°ƒç”¨åˆ›å»ºæœ¬åœ°æ¨¡å‹

##### `trainmodel/generator.py` - FedGen ç”Ÿæˆå™¨
**ä¸»è¦ä½œç”¨ï¼š** ä¸º FedGen ç®—æ³•æä¾›ç”Ÿæˆå™¨ç½‘ç»œï¼Œç”¨äºæ•°æ®è‡ªç”±çš„çŸ¥è¯†è’¸é¦ã€‚

**å…³é”®ç±»ï¼š**
- `Generator(nn.Module)`ï¼šç”Ÿæˆä¼ªç‰¹å¾æˆ–ä¼ª logits
  - è¾“å…¥ï¼šæ½œåœ¨å‘é‡ `z` `[Batch, latent_dim]`
  - è¾“å‡ºï¼šä¼ªåµŒå…¥ `[Batch, embedding_dim]`
  
- `ConditionalGenerator(nn.Module)`ï¼šæ¡ä»¶ç”Ÿæˆå™¨ï¼ˆæ ¹æ®ç±»åˆ«æ ‡ç­¾ç”Ÿæˆï¼‰

**ä¸å…¶ä»–æ–‡ä»¶çš„äº¤äº’ï¼š**
- è¢« `userpFedGen.py` å’Œ `serverpFedGen.py` ä½¿ç”¨

---

##### `users/userbase.py` - å®¢æˆ·ç«¯åŸºç±»
**ä¸»è¦ä½œç”¨ï¼š** å®šä¹‰è”é‚¦å­¦ä¹ å®¢æˆ·ç«¯çš„é€šç”¨æ¥å£å’ŒåŸºæœ¬åŠŸèƒ½ã€‚

**å…³é”®ç±»ï¼š**
- `User`ï¼šå®¢æˆ·ç«¯åŸºç±»
  - **å±æ€§**ï¼š`id`ï¼ˆå®¢æˆ·ç«¯IDï¼‰ã€`model`ï¼ˆæœ¬åœ°æ¨¡å‹ï¼‰ã€`train_loader`ï¼ˆè®­ç»ƒæ•°æ®ï¼‰ã€`optimizer`ï¼ˆä¼˜åŒ–å™¨ï¼‰
  - **æ ¸å¿ƒæ–¹æ³•**ï¼š
    - `set_parameters(params)`ï¼šæ¥æ”¶æœåŠ¡å™¨å‘é€çš„å…¨å±€æ¨¡å‹å‚æ•°
    - `get_parameters()`ï¼šè¿”å›æœ¬åœ°æ¨¡å‹å‚æ•°ç»™æœåŠ¡å™¨
    - `train(epochs)`ï¼š**æŠ½è±¡æ–¹æ³•**ï¼Œå­ç±»å¿…é¡»å®ç°æœ¬åœ°è®­ç»ƒé€»è¾‘
    - `test(test_loader)`ï¼šåœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°æ¨¡å‹

**ä¸å…¶ä»–æ–‡ä»¶çš„äº¤äº’ï¼š**
- è¢« `useravg.py`ã€`userFedProx.py`ã€`userpFedGen.py` ç»§æ‰¿

##### `users/useravg.py` - FedAvg å®¢æˆ·ç«¯
**ä¸»è¦ä½œç”¨ï¼š** å®ç° FedAvg ç®—æ³•çš„å®¢æˆ·ç«¯ï¼Œæ‰§è¡Œæ ‡å‡†çš„æœ¬åœ° SGD è®­ç»ƒã€‚

**å…³é”®ç±»ï¼š**
- `UserAVG(User)`ï¼šFedAvg å®¢æˆ·ç«¯
  - `train(epochs)`ï¼šæ ‡å‡†çš„ SGD è®­ç»ƒï¼Œä½¿ç”¨äº¤å‰ç†µæŸå¤±

**è®­ç»ƒæµç¨‹ï¼š**
1. æ¥æ”¶å…¨å±€æ¨¡å‹å‚æ•°
2. åœ¨æœ¬åœ°æ•°æ®ä¸Šè®­ç»ƒè‹¥å¹²è½®
3. è¿”å›æ›´æ–°åçš„æœ¬åœ°æ¨¡å‹å‚æ•°

##### `users/userFedProx.py` - FedProx å®¢æˆ·ç«¯
**ä¸»è¦ä½œç”¨ï¼š** å®ç° FedProx ç®—æ³•çš„å®¢æˆ·ç«¯ï¼Œåœ¨æŸå¤±å‡½æ•°ä¸­æ·»åŠ è¿‘ç«¯æ­£åˆ™åŒ–é¡¹ã€‚

**å…³é”®ç±»ï¼š**
- `UserFedProx(User)`ï¼šFedProx å®¢æˆ·ç«¯
  - **é¢å¤–å±æ€§**ï¼š`mu`ï¼ˆè¿‘ç«¯é¡¹ç³»æ•°ï¼‰ã€`global_params`ï¼ˆä¿å­˜çš„å…¨å±€å‚æ•°ï¼‰
  - `train(epochs)`ï¼šå¸¦è¿‘ç«¯é¡¹çš„è®­ç»ƒ
    - **æŸå¤±å‡½æ•°**ï¼š`Loss = CE_Loss + (mu/2) * ||w - w_global||Â²`
    - è¿‘ç«¯é¡¹æƒ©ç½šæœ¬åœ°å‚æ•°åç¦»å…¨å±€å‚æ•°å¤ªè¿œï¼Œæé«˜æ”¶æ•›ç¨³å®šæ€§

**ä¸ FedAvg çš„åŒºåˆ«ï¼š** ä»…åœ¨æŸå¤±å‡½æ•°è®¡ç®—ä¸Šæœ‰å·®å¼‚ï¼ŒæœåŠ¡å™¨èšåˆé€»è¾‘ç›¸åŒã€‚

##### `users/userpFedGen.py` - FedGen å®¢æˆ·ç«¯
**ä¸»è¦ä½œç”¨ï¼š** å®ç° FedGen ç®—æ³•çš„å®¢æˆ·ç«¯ï¼Œä½¿ç”¨ç”Ÿæˆå™¨è¿›è¡ŒçŸ¥è¯†è’¸é¦ã€‚

**å…³é”®ç±»ï¼š**
- `UserFedGen(User)`ï¼šFedGen å®¢æˆ·ç«¯
  - **é¢å¤–å±æ€§**ï¼š`generator`ï¼ˆæœ¬åœ°ç”Ÿæˆå™¨ï¼‰ã€`gen_optimizer`ï¼ˆç”Ÿæˆå™¨ä¼˜åŒ–å™¨ï¼‰
  - `train(epochs)`ï¼š**ä¸¤é˜¶æ®µè®­ç»ƒ**
    1. **è®­ç»ƒç”Ÿæˆå™¨**ï¼šæœ€å°åŒ–ç”Ÿæˆæ•°æ®ä¸çœŸå®æ•°æ®åœ¨åˆ†ç±»å™¨ä¸Šçš„è¾“å‡ºå·®å¼‚ï¼ˆKL æ•£åº¦ï¼‰
    2. **è®­ç»ƒåˆ†ç±»å™¨**ï¼šä½¿ç”¨çœŸå®æ•°æ® + ç”Ÿæˆå™¨ç”Ÿæˆçš„ä¼ªæ•°æ®

**ç‰¹ç‚¹ï¼š** é€šè¿‡ç”Ÿæˆå™¨åœ¨å®¢æˆ·ç«¯ä¹‹é—´å…±äº«çŸ¥è¯†ï¼Œè€Œä¸æ˜¯å…±äº«åŸå§‹æ•°æ®ã€‚

---

##### `servers/serverbase.py` - æœåŠ¡å™¨åŸºç±»
**ä¸»è¦ä½œç”¨ï¼š** å®šä¹‰è”é‚¦å­¦ä¹ æœåŠ¡å™¨çš„é€šç”¨æ¥å£ã€‚

**å…³é”®ç±»ï¼š**
- `Server`ï¼šæœåŠ¡å™¨åŸºç±»
  - **å±æ€§**ï¼š`model`ï¼ˆå…¨å±€æ¨¡å‹ï¼‰ã€`users`ï¼ˆå®¢æˆ·ç«¯åˆ—è¡¨ï¼‰ã€`num_rounds`ï¼ˆè®­ç»ƒè½®æ¬¡ï¼‰
  - **æ ¸å¿ƒæ–¹æ³•**ï¼š
    - `send_parameters()`ï¼šå°†å…¨å±€æ¨¡å‹å‚æ•°å‘é€ç»™æ‰€æœ‰å®¢æˆ·ç«¯
    - `aggregate_parameters()`ï¼š**æŠ½è±¡æ–¹æ³•**ï¼Œèšåˆå®¢æˆ·ç«¯æ¨¡å‹å‚æ•°
    - `evaluate(test_loader)`ï¼šåœ¨å…¨å±€æµ‹è¯•é›†ä¸Šè¯„ä¼°æ¨¡å‹
    - `train()`ï¼š**æŠ½è±¡æ–¹æ³•**ï¼Œåè°ƒæ•´ä¸ªè”é‚¦å­¦ä¹ æµç¨‹

##### `servers/serveravg.py` - FedAvg æœåŠ¡å™¨
**ä¸»è¦ä½œç”¨ï¼š** å®ç° FedAvg ç®—æ³•çš„æœåŠ¡å™¨ç«¯ã€‚

**å…³é”®ç±»ï¼š**
- `ServerAVG(Server)`ï¼šFedAvg æœåŠ¡å™¨
  - `aggregate_parameters()`ï¼š**åŠ æƒå¹³å‡**èšåˆå®¢æˆ·ç«¯å‚æ•°
    - æƒé‡ä¸ºå„å®¢æˆ·ç«¯çš„æ ·æœ¬æ•°æ¯”ä¾‹
  - `train(test_loader, local_epochs, logger)`ï¼šè”é‚¦å­¦ä¹ ä¸»å¾ªç¯
    1. å‘é€å…¨å±€æ¨¡å‹ç»™å®¢æˆ·ç«¯
    2. å®¢æˆ·ç«¯æœ¬åœ°è®­ç»ƒ
    3. èšåˆå®¢æˆ·ç«¯æ¨¡å‹
    4. åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°
    5. è®°å½•æ—¥å¿—å’ŒæŒ‡æ ‡

##### `servers/serverFedProx.py` - FedProx æœåŠ¡å™¨
**ä¸»è¦ä½œç”¨ï¼š** FedProx çš„æœåŠ¡å™¨ç«¯å®ç°ã€‚

**å…³é”®ç±»ï¼š**
- `ServerFedProx(ServerAVG)`ï¼šç»§æ‰¿è‡ª `ServerAVG`
  - **èšåˆé€»è¾‘ä¸ FedAvg å®Œå…¨ç›¸åŒ**
  - FedProx çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºå®¢æˆ·ç«¯çš„è¿‘ç«¯é¡¹è®­ç»ƒ

##### `servers/serverpFedGen.py` - FedGen æœåŠ¡å™¨
**ä¸»è¦ä½œç”¨ï¼š** å®ç° FedGen ç®—æ³•çš„æœåŠ¡å™¨ç«¯ï¼Œéœ€è¦åŒæ—¶èšåˆåˆ†ç±»å™¨å’Œç”Ÿæˆå™¨ã€‚

**å…³é”®ç±»ï¼š**
- `ServerFedGen(Server)`ï¼šFedGen æœåŠ¡å™¨
  - **é¢å¤–å±æ€§**ï¼š`generator`ï¼ˆå…¨å±€ç”Ÿæˆå™¨ï¼‰
  - `send_parameters()`ï¼šåŒæ—¶å‘é€åˆ†ç±»å™¨å’Œç”Ÿæˆå™¨å‚æ•°
  - `aggregate_parameters()`ï¼šèšåˆåˆ†ç±»å™¨å‚æ•° + èšåˆç”Ÿæˆå™¨å‚æ•°
  - `train()`ï¼šç»´æŠ¤å…¨å±€ç”Ÿæˆå™¨çš„è®­ç»ƒå¾ªç¯

---

#### ğŸ“ utils/ - å·¥å…·æ¨¡å—

##### `model_config.py` - æ•°æ®é›†é…ç½®
**ä¸»è¦ä½œç”¨ï¼š** å­˜å‚¨å„ä¸ªæ•°æ®é›†çš„å…ƒä¿¡æ¯ã€‚

**å†…å®¹ï¼š**
- `DATASET_CONFIG`ï¼šå­—å…¸ï¼ŒåŒ…å«æ¯ä¸ªæ•°æ®é›†çš„ç±»åˆ«æ•°ã€ä¿¡å·é•¿åº¦ã€ç±»åˆ«åç§°
- `get_dataset_config(dataset_name)`ï¼šæ ¹æ®æ•°æ®é›†åç§°è¿”å›é…ç½®

**ä¸å…¶ä»–æ–‡ä»¶çš„äº¤äº’ï¼š**
- è¢« `data_loader.py` å’Œ `main.py` è°ƒç”¨è·å–æ•°æ®é›†ä¿¡æ¯

##### `model_utils.py` - æ¨¡å‹å·¥å…·å‡½æ•°
**ä¸»è¦ä½œç”¨ï¼š** æä¾›æ¨¡å‹å‚æ•°å¤„ç†ã€æ—¥å¿—è®°å½•ç­‰å·¥å…·å‡½æ•°ã€‚

**å…³é”®å‡½æ•°ï¼š**
- `get_model_params(model)`ï¼šæå–æ¨¡å‹å‚æ•°ï¼ˆè¿”å› OrderedDictï¼‰
- `set_model_params(model, params)`ï¼šè®¾ç½®æ¨¡å‹å‚æ•°
- `average_weights(weights_list, weights)`ï¼š**åŠ æƒå¹³å‡å¤šä¸ªæ¨¡å‹å‚æ•°**ï¼ˆæœåŠ¡å™¨èšåˆæ ¸å¿ƒï¼‰
- `save_logs(log_file, round_num, accuracy, loss)`ï¼šä¿å­˜ CSV è®­ç»ƒæ—¥å¿—
- `setup_logger(log_file, name)`ï¼šé…ç½®æ—¥å¿—è®°å½•å™¨
- `save_model(model, save_path)`ï¼šä¿å­˜æ¨¡å‹æƒé‡ä¸º .pt æ–‡ä»¶
- `load_model(model, load_path)`ï¼šåŠ è½½æ¨¡å‹æƒé‡

**ä¸å…¶ä»–æ–‡ä»¶çš„äº¤äº’ï¼š**
- è¢«æ‰€æœ‰ Server å’Œ User ç±»ä½¿ç”¨
- è¢« `main.py` è°ƒç”¨ä¿å­˜è®­ç»ƒç»“æœ

##### `plot_utils.py` - ç»˜å›¾å·¥å…·
**ä¸»è¦ä½œç”¨ï¼š** æä¾›ç»“æœå¯è§†åŒ–åŠŸèƒ½ã€‚

**å…³é”®å‡½æ•°ï¼š**
- `plot_accuracy_curves(logs_dict, title, save_path)`ï¼šç»˜åˆ¶å‡†ç¡®ç‡å¯¹æ¯”æ›²çº¿
- `plot_loss_curves(logs_dict, title, save_path)`ï¼šç»˜åˆ¶æŸå¤±å¯¹æ¯”æ›²çº¿
- `plot_combined_curves(logs_dict_acc, logs_dict_loss, title, save_path)`ï¼šç»˜åˆ¶ç»„åˆå›¾
- `plot_confusion_matrix(y_true, y_pred, classes, title, save_path)`ï¼šç»˜åˆ¶æ··æ·†çŸ©é˜µ

**ä¸å…¶ä»–æ–‡ä»¶çš„äº¤äº’ï¼š**
- è¢« `main_plot.py` è°ƒç”¨ç”Ÿæˆå¯¹æ¯”å›¾è¡¨

---

#### ğŸ“„ ä¸»ç¨‹åºæ–‡ä»¶

##### `main.py` â­â­â­ **æœ€é‡è¦çš„ä¸»ç¨‹åº**
**ä¸»è¦ä½œç”¨ï¼š** é¡¹ç›®çš„æ ¸å¿ƒå…¥å£ï¼Œè´Ÿè´£è§£æå‚æ•°ã€åŠ è½½æ•°æ®ã€åˆ›å»ºæ¨¡å‹ã€æ‰§è¡Œè®­ç»ƒã€ä¿å­˜ç»“æœã€‚

**ä¸»è¦æµç¨‹ï¼š**
1. **è§£æå‘½ä»¤è¡Œå‚æ•°**ï¼ˆ`parse_args()`ï¼‰
   - æ•°æ®é›†é€‰æ‹©ã€ç®—æ³•é€‰æ‹©ã€æ¨¡å‹é€‰æ‹©
   - è”é‚¦å­¦ä¹ å‚æ•°ï¼ˆå®¢æˆ·ç«¯æ•°é‡ã€è®­ç»ƒè½®æ¬¡ã€æœ¬åœ° epoch ç­‰ï¼‰
   - Non-IID å‚æ•°ï¼ˆåˆ’åˆ†ç±»å‹ã€Dirichlet å‚æ•° alpha ç­‰ï¼‰

2. **åŠ è½½æ•°æ®é›†**ï¼ˆè°ƒç”¨ `get_dataloaders()`ï¼‰
   - æ ¹æ® `--dataset` å‚æ•°åŠ è½½å¯¹åº”æ•°æ®é›†
   - æ ¹æ® `--non_iid_type` åˆ’åˆ†å®¢æˆ·ç«¯æ•°æ®ï¼ˆIID/Non-IIDï¼‰

3. **åˆ›å»ºæ¨¡å‹**ï¼ˆè°ƒç”¨ `get_model()`ï¼‰
   - æ ¹æ® `--model` å‚æ•°åˆ›å»ºå…¨å±€æ¨¡å‹ï¼ˆCNN1D æˆ– ResNet1Dï¼‰

4. **åˆ›å»ºå®¢æˆ·ç«¯**ï¼ˆ`create_users()`ï¼‰
   - æ ¹æ® `--algorithm` å‚æ•°åˆ›å»ºå¯¹åº”çš„å®¢æˆ·ç«¯åˆ—è¡¨
   - FedAvg â†’ UserAVG
   - FedProx â†’ UserFedProx
   - FedGen â†’ UserFedGen

5. **åˆ›å»ºæœåŠ¡å™¨**ï¼ˆ`create_server()`ï¼‰
   - æ ¹æ® `--algorithm` å‚æ•°åˆ›å»ºå¯¹åº”çš„æœåŠ¡å™¨
   - FedAvg â†’ ServerAVG
   - FedProx â†’ ServerFedProx
   - FedGen â†’ ServerFedGen

6. **æ‰§è¡Œè®­ç»ƒ**ï¼ˆ`server.train()`ï¼‰
   - è”é‚¦å­¦ä¹ ä¸»å¾ªç¯

7. **ä¿å­˜ç»“æœ**
   - CSV æ–‡ä»¶ï¼š`results/{dataset}_{algorithm}_metrics.csv`ï¼ˆå‡†ç¡®ç‡ã€æŸå¤±ï¼‰
   - TXT æ–‡ä»¶ï¼š`results/{dataset}_{algorithm}_log.txt`ï¼ˆå®Œæ•´æ—¥å¿—ï¼‰
   - PT æ–‡ä»¶ï¼š`results/{dataset}_{algorithm}_model.pt`ï¼ˆæ¨¡å‹æƒé‡ï¼‰

**å‘½ä»¤è¡Œå‚æ•°è¯¦è§£ï¼š**
```bash
--dataset         # æ•°æ®é›†åç§°ï¼ˆRML2016.10a, RML2016.10b, RML2018a, HisarModï¼‰
--algorithm       # è”é‚¦å­¦ä¹ ç®—æ³•ï¼ˆFedAvg, FedProx, FedGenï¼‰
--model           # æ¨¡å‹æ¶æ„ï¼ˆCNN1D, ResNet1Dï¼‰
--num_clients     # å®¢æˆ·ç«¯æ•°é‡ï¼ˆé»˜è®¤ 10ï¼‰
--num_rounds      # è”é‚¦å­¦ä¹ è½®æ¬¡ï¼ˆé»˜è®¤ 100ï¼‰
--local_epochs    # å®¢æˆ·ç«¯æœ¬åœ°è®­ç»ƒè½®æ•°ï¼ˆé»˜è®¤ 5ï¼‰
--batch_size      # æ‰¹å¤§å°ï¼ˆé»˜è®¤ 128ï¼‰
--learning_rate   # å­¦ä¹ ç‡ï¼ˆé»˜è®¤ 0.01ï¼‰
--optimizer       # ä¼˜åŒ–å™¨ç±»å‹ï¼ˆsgd, adam, adamwï¼Œé»˜è®¤ adamï¼‰
--momentum        # SGD åŠ¨é‡å‚æ•°ï¼ˆé»˜è®¤ 0.9ï¼Œä»… sgd ä½¿ç”¨ï¼‰
--weight_decay    # æƒé‡è¡°å‡/L2 æ­£åˆ™åŒ–ï¼ˆé»˜è®¤ 1e-4ï¼‰
--non_iid_type    # æ•°æ®åˆ’åˆ†ç±»å‹ï¼ˆiid, class, snrï¼‰
--alpha           # Dirichlet å‚æ•°ï¼ˆé»˜è®¤ 0.5ï¼Œç”¨äº class Non-IIDï¼‰
--mu              # FedProx è¿‘ç«¯é¡¹ç³»æ•°ï¼ˆé»˜è®¤ 0.01ï¼‰
--output_dir      # è¾“å‡ºç›®å½•ï¼ˆé»˜è®¤ ./resultsï¼‰
```

##### `main_plot.py` - ç»“æœå¯è§†åŒ–ç¨‹åº
**ä¸»è¦ä½œç”¨ï¼š** è¯»å–è®­ç»ƒæ—¥å¿—ï¼ˆCSV æ–‡ä»¶ï¼‰ï¼Œç»˜åˆ¶å¤šä¸ªç®—æ³•çš„å¯¹æ¯”æ›²çº¿ã€‚

**ä¸»è¦æµç¨‹ï¼š**
1. è§£æå‘½ä»¤è¡Œå‚æ•°ï¼ˆæ•°æ®é›†åç§°ã€ç®—æ³•åˆ—è¡¨ã€è¾“å‡ºç›®å½•ï¼‰
2. è¯»å–å„ä¸ªç®—æ³•çš„ CSV æŒ‡æ ‡æ–‡ä»¶
3. è°ƒç”¨ `plot_utils.py` ä¸­çš„å‡½æ•°ç»˜åˆ¶å¯¹æ¯”å›¾
4. ä¿å­˜å›¾è¡¨åˆ° `results/plots/` ç›®å½•

**å‘½ä»¤è¡Œå‚æ•°ï¼š**
```bash
--dataset       # æ•°æ®é›†åç§°
--metrics_dir   # CSV æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼ˆé»˜è®¤ ./resultsï¼‰
--algorithms    # è¦å¯¹æ¯”çš„ç®—æ³•åˆ—è¡¨ï¼ˆé»˜è®¤ FedAvg FedProx FedGenï¼‰
--output_dir    # å›¾è¡¨ä¿å­˜ç›®å½•ï¼ˆé»˜è®¤ ./results/plotsï¼‰
```

---

#### ğŸ”§ è¾…åŠ©è„šæœ¬

##### `run_example.bat` - Windows å¿«é€Ÿç¤ºä¾‹è„šæœ¬
**ä½œç”¨ï¼š** ä¸€é”®è¿è¡Œä¸‰ç§ç®—æ³•çš„å¿«é€Ÿç¤ºä¾‹ï¼ˆ10è½®è®­ç»ƒï¼‰

##### `run_full_experiment.bat` - Windows å®Œæ•´å®éªŒè„šæœ¬
**ä½œç”¨ï¼š** ä¸€é”®è¿è¡Œå®Œæ•´å®éªŒï¼ˆ100è½®è®­ç»ƒï¼‰+ ç”Ÿæˆå¯¹æ¯”å›¾

---

## 3. ç¯å¢ƒé…ç½® (Environment Setup)

### ä¾èµ–åˆ—è¡¨
æœ¬é¡¹ç›®éœ€è¦ä»¥ä¸‹ Python åº“ï¼š

```
torch >= 1.10.0           # PyTorch æ·±åº¦å­¦ä¹ æ¡†æ¶
torchvision >= 0.11.0     # PyTorch è§†è§‰å·¥å…·
numpy >= 1.21.0           # æ•°å€¼è®¡ç®—åº“
h5py >= 3.6.0             # HDF5 æ–‡ä»¶è¯»å–
matplotlib >= 3.5.0       # ç»˜å›¾åº“
scikit-learn >= 1.0.0     # æœºå™¨å­¦ä¹ å·¥å…·ï¼ˆç”¨äºæ··æ·†çŸ©é˜µç­‰ï¼‰
tqdm >= 4.62.0            # è¿›åº¦æ¡
pandas >= 1.3.0           # æ•°æ®å¤„ç†ï¼ˆç”¨äºè¯»å–CSVï¼‰
```

### å®‰è£…æ­¥éª¤

#### æ­¥éª¤ 1ï¼šåˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èä½¿ç”¨ Condaï¼‰

**ä½¿ç”¨ Condaï¼š**
```bash
# åˆ›å»ºåä¸º fl_amr çš„è™šæ‹Ÿç¯å¢ƒï¼ŒPython ç‰ˆæœ¬ 3.8
conda create -n fl_amr python=3.8

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
conda activate fl_amr
```

**æˆ–ä½¿ç”¨ venvï¼š**
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate
```

#### æ­¥éª¤ 2ï¼šå®‰è£… PyTorch

**å¦‚æœæœ‰ CUDA GPUï¼ˆæ¨èï¼‰ï¼š**
```bash
# CUDA 11.3 ç‰ˆæœ¬
conda install pytorch torchvision torchaudio cudatoolkit=11.3 -c pytorch

# æˆ–ä½¿ç”¨ pipï¼ˆæ ¹æ®ä½ çš„ CUDA ç‰ˆæœ¬é€‰æ‹©ï¼‰
pip install torch torchvision torchaudio --extra-index-url https://download.pytorch.org/whl/cu113
```

**å¦‚æœåªæœ‰ CPUï¼š**
```bash
conda install pytorch torchvision torchaudio cpuonly -c pytorch

# æˆ–ä½¿ç”¨ pip
pip install torch torchvision torchaudio
```

#### æ­¥éª¤ 3ï¼šå®‰è£…å…¶ä»–ä¾èµ–

```bash
# ä½¿ç”¨ requirements.txt å®‰è£…æ‰€æœ‰ä¾èµ–
pip install -r requirements.txt
```

#### æ­¥éª¤ 4ï¼šéªŒè¯å®‰è£…

```bash
# æ£€æŸ¥ PyTorch æ˜¯å¦å®‰è£…æˆåŠŸ
python -c "import torch; print(torch.__version__); print('CUDA available:', torch.cuda.is_available())"
```

### ç¡¬ä»¶è¦æ±‚

- **æœ€ä½é…ç½®ï¼š** 
  - CPUï¼š4æ ¸å¿ƒ
  - å†…å­˜ï¼š8 GB RAM
  - å­˜å‚¨ï¼š10 GB å¯ç”¨ç©ºé—´

- **æ¨èé…ç½®ï¼š**
  - GPUï¼šNVIDIA GPUï¼ˆ6 GB VRAM ä»¥ä¸Šï¼Œå¦‚ RTX 2060/3060ï¼‰
  - CUDAï¼š11.0 æˆ–æ›´é«˜ç‰ˆæœ¬
  - å†…å­˜ï¼š16 GB RAM
  - å­˜å‚¨ï¼š20 GB å¯ç”¨ç©ºé—´

---

## 4. ä½¿ç”¨è¯´æ˜ (Usage)

### 4.1 æ•°æ®å‡†å¤‡ (Data Preparation)

#### ä¸‹è½½æ•°æ®é›†

æœ¬é¡¹ç›®æ”¯æŒå››ä¸ªå…¬å¼€çš„æ— çº¿ä¿¡å·è°ƒåˆ¶è¯†åˆ«æ•°æ®é›†ï¼š

1. **RML2016.10a** å’Œ **RML2016.10b**
   - ä¸‹è½½åœ°å€ï¼š[RadioML Website](https://www.deepsig.ai/datasets)
   - å°†ä¸‹è½½çš„æ–‡ä»¶æ”¾ç½®åœ¨ï¼š
     - `dataset/RML2016.10a/RML2016.10a_dict.pkl`
     - `dataset/RML2016.10b/RML2016.10b.dat`

2. **RML2018a**
   - ä¸‹è½½åœ°å€ï¼š[RadioML 2018.01a](https://www.deepsig.ai/datasets)
   - å°†æ–‡ä»¶æ”¾ç½®åœ¨ï¼š`dataset/RML2018a/GOLD_XYZ_OSC.0001_1024.hdf5`

3. **HisarMod**
   - ä¸‹è½½åœ°å€ï¼šéœ€è¦è®¿é—®ç›¸å…³ç ”ç©¶æœºæ„
   - å°†æ–‡ä»¶æ”¾ç½®åœ¨ï¼š
     - `dataset/HisarMod/HisarMod2019train.h5`
     - `dataset/HisarMod/HisarMod2019test.h5`

#### æ•°æ®é›†ç›®å½•ç»“æ„

ç¡®ä¿ä½ çš„ `dataset/` ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
dataset/
â”œâ”€â”€ RML2016.10a/
â”‚   â””â”€â”€ RML2016.10a_dict.pkl
â”œâ”€â”€ RML2016.10b/
â”‚   â””â”€â”€ RML2016.10b.dat
â”œâ”€â”€ RML2018a/
â”‚   â””â”€â”€ GOLD_XYZ_OSC.0001_1024.hdf5
â””â”€â”€ HisarMod/
    â”œâ”€â”€ HisarMod2019train.h5
    â””â”€â”€ HisarMod2019test.h5
```

**æ³¨æ„ï¼š** æ•°æ®æ–‡ä»¶è¾ƒå¤§ï¼ˆæ¯ä¸ªæ•°æ®é›† 1-5 GBï¼‰ï¼Œè¯·ç¡®ä¿æœ‰è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´ã€‚

#### æ•°æ®æ ¼å¼è¯´æ˜

- **è¾“å…¥æ•°æ®æ ¼å¼ï¼š** `[N, 2, L]`
  - `N`ï¼šæ ·æœ¬æ•°é‡
  - `2`ï¼šI/Q åŒé€šé“ï¼ˆåŒç›¸å’Œæ­£äº¤åˆ†é‡ï¼‰
  - `L`ï¼šé‡‡æ ·ç‚¹æ•°ï¼ˆ128 æˆ– 1024ï¼‰

- **æ ‡ç­¾æ ¼å¼ï¼š** æ•´æ•°ç¼–ç ï¼ŒèŒƒå›´ `[0, num_classes-1]`

---

### 4.2 è®­ç»ƒæµç¨‹ (Training Process)

#### åŸºç¡€è®­ç»ƒå‘½ä»¤

**å¿«é€Ÿæµ‹è¯•ï¼ˆ10è½®è®­ç»ƒï¼‰ï¼š**
```bash
python main.py --dataset RML2016.10a --algorithm FedAvg --num_rounds 10 --num_clients 5
```

#### å®Œæ•´è®­ç»ƒç¤ºä¾‹

##### ç¤ºä¾‹ 1ï¼šFedAvg ç®—æ³• + IID æ•°æ®åˆ’åˆ†

```bash
python main.py \
  --dataset RML2016.10a \
  --algorithm FedAvg \
  --model CNN1D \
  --num_clients 10 \
  --num_rounds 100 \
  --local_epochs 5 \
  --batch_size 128 \
  --learning_rate 0.01 \
  --non_iid_type iid \
  --output_dir ./results
```

**å‚æ•°è§£é‡Šï¼š**
- `--dataset RML2016.10a`ï¼šä½¿ç”¨ RML2016.10a æ•°æ®é›†ï¼ˆ11ç±»è°ƒåˆ¶ï¼Œ128é‡‡æ ·ç‚¹ï¼‰
- `--algorithm FedAvg`ï¼šä½¿ç”¨è”é‚¦å¹³å‡ç®—æ³•
- `--model CNN1D`ï¼šä½¿ç”¨è½»é‡çº§ CNN1D æ¨¡å‹
- `--num_clients 10`ï¼šæ¨¡æ‹Ÿ 10 ä¸ªå®¢æˆ·ç«¯
- `--num_rounds 100`ï¼šè”é‚¦å­¦ä¹ è®­ç»ƒ 100 è½®
- `--local_epochs 5`ï¼šæ¯ä¸ªå®¢æˆ·ç«¯æœ¬åœ°è®­ç»ƒ 5 è½®
- `--batch_size 128`ï¼šæ‰¹å¤§å°ä¸º 128
- `--learning_rate 0.01`ï¼šå­¦ä¹ ç‡ä¸º 0.01
- `--non_iid_type iid`ï¼šä½¿ç”¨ IIDï¼ˆç‹¬ç«‹åŒåˆ†å¸ƒï¼‰æ•°æ®åˆ’åˆ†
- `--output_dir ./results`ï¼šç»“æœä¿å­˜åˆ° `./results` ç›®å½•

##### ç¤ºä¾‹ 2ï¼šFedProx ç®—æ³• + Non-IIDï¼ˆæŒ‰ç±»åˆ«ï¼‰æ•°æ®åˆ’åˆ†

```bash
python main.py \
  --dataset RML2016.10a \
  --algorithm FedProx \
  --model CNN1D \
  --num_clients 10 \
  --num_rounds 100 \
  --local_epochs 5 \
  --batch_size 128 \
  --learning_rate 0.01 \
  --non_iid_type class \
  --alpha 0.5 \
  --mu 0.01
```

**é¢å¤–å‚æ•°ï¼š**
- `--non_iid_type class`ï¼šæŒ‰è°ƒåˆ¶ç±»å‹è¿›è¡Œ Non-IID åˆ’åˆ†ï¼ˆä½¿ç”¨ Dirichlet åˆ†å¸ƒï¼‰
- `--alpha 0.5`ï¼šDirichlet åˆ†å¸ƒå‚æ•°ï¼Œ**è¶Šå°æ•°æ®è¶Šä¸å‡è¡¡**ï¼ˆ0.1 = é«˜åº¦ä¸å‡è¡¡ï¼Œ1.0 = è¾ƒå‡è¡¡ï¼‰
- `--mu 0.01`ï¼šFedProx è¿‘ç«¯é¡¹ç³»æ•°ï¼Œæ§åˆ¶æœ¬åœ°æ¨¡å‹ä¸å…¨å±€æ¨¡å‹çš„åç¦»ç¨‹åº¦

##### ç¤ºä¾‹ 3ï¼šFedGen ç®—æ³• + Non-IIDï¼ˆæŒ‰ SNRï¼‰æ•°æ®åˆ’åˆ†

```bash
python main.py \
  --dataset RML2016.10a \
  --algorithm FedGen \
  --model CNN1D \
  --num_clients 10 \
  --num_rounds 100 \
  --local_epochs 5 \
  --batch_size 128 \
  --learning_rate 0.01 \
  --non_iid_type snr \
  --gen_learning_rate 0.001
```

**é¢å¤–å‚æ•°ï¼š**
- `--non_iid_type snr`ï¼šæŒ‰ SNRï¼ˆä¿¡å™ªæ¯”ï¼‰èŒƒå›´è¿›è¡Œ Non-IID åˆ’åˆ†ï¼Œä¸åŒå®¢æˆ·ç«¯è·å¾—ä¸åŒ SNR æ®µçš„æ•°æ®
- `--gen_learning_rate 0.001`ï¼šç”Ÿæˆå™¨çš„å­¦ä¹ ç‡ï¼ˆFedGen ä¸“ç”¨ï¼‰

##### ç¤ºä¾‹ 4ï¼šResNet1D æ¨¡å‹ + RML2018a æ•°æ®é›†

```bash
python main.py \
  --dataset RML2018a \
  --algorithm FedAvg \
  --model ResNet1D \
  --num_clients 10 \
  --num_rounds 100 \
  --local_epochs 5 \
  --batch_size 64 \
  --learning_rate 0.001
```

**è¯´æ˜ï¼š** RML2018a æœ‰ 24 ç±»è°ƒåˆ¶å’Œ 1024 é‡‡æ ·ç‚¹ï¼Œæ•°æ®é‡æ›´å¤§ï¼Œæ¨èä½¿ç”¨ ResNet1D æ¨¡å‹ã€‚

---

#### è®­ç»ƒè¾“å‡ºè¯´æ˜

è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œç¨‹åºä¼šå®æ—¶è¾“å‡ºæ—¥å¿—ï¼š

```
================================================================================
è”é‚¦å­¦ä¹ è‡ªåŠ¨è°ƒåˆ¶è¯†åˆ«
================================================================================
æ•°æ®é›†: RML2016.10a
ç®—æ³•: FedAvg
æ¨¡å‹: CNN1D
å®¢æˆ·ç«¯æ•°é‡: 10
è®­ç»ƒè½®æ¬¡: 100
...
================================================================================
å¼€å§‹è®­ç»ƒ...
================================================================================
Round 1/100 | Local Loss: 2.1234 | Test Loss: 2.0456 | Test Accuracy: 23.45%
Round 2/100 | Local Loss: 1.8765 | Test Loss: 1.8123 | Test Accuracy: 31.23%
...
```

#### è®­ç»ƒç»“æœä¿å­˜ä½ç½®

è®­ç»ƒå®Œæˆåï¼Œä»¥ä¸‹æ–‡ä»¶ä¼šè‡ªåŠ¨ä¿å­˜åœ¨ `results/` ç›®å½•ï¼š

1. **CSV æŒ‡æ ‡æ–‡ä»¶ï¼š** `results/RML2016.10a_FedAvg_metrics.csv`
   ```csv
   Round,Accuracy,Loss
   1,23.45,2.0456
   2,31.23,1.8123
   ...
   ```

2. **TXT æ—¥å¿—æ–‡ä»¶ï¼š** `results/RML2016.10a_FedAvg_log.txt`
   - åŒ…å«å®Œæ•´çš„è®­ç»ƒæ—¥å¿—ï¼Œå¸¦æ—¶é—´æˆ³

3. **æ¨¡å‹æƒé‡æ–‡ä»¶ï¼š** `results/RML2016.10a_FedAvg_model.pt`
   - PyTorch state_dict æ ¼å¼ï¼Œå¯ç”¨äºåç»­åŠ è½½

---

### 4.3 æµ‹è¯•/æ¨ç†æµç¨‹ (Testing/Inference Process)

#### å¯è§†åŒ–è®­ç»ƒç»“æœ

è®­ç»ƒå®Œæˆåï¼Œä½¿ç”¨ `main_plot.py` ç»˜åˆ¶å¯¹æ¯”æ›²çº¿ï¼š

```bash
python main_plot.py \
  --dataset RML2016.10a \
  --metrics_dir ./results \
  --algorithms FedAvg FedProx FedGen \
  --output_dir ./results/plots
```

**å‚æ•°è§£é‡Šï¼š**
- `--dataset RML2016.10a`ï¼šæŒ‡å®šæ•°æ®é›†åç§°
- `--metrics_dir ./results`ï¼šCSV æŒ‡æ ‡æ–‡ä»¶æ‰€åœ¨ç›®å½•
- `--algorithms FedAvg FedProx FedGen`ï¼šè¦å¯¹æ¯”çš„ç®—æ³•åˆ—è¡¨
- `--output_dir ./results/plots`ï¼šå›¾è¡¨ä¿å­˜ç›®å½•

**è¾“å‡ºæ–‡ä»¶ï¼š**
- `results/plots/RML2016.10a_accuracy_comparison.png`ï¼šå‡†ç¡®ç‡å¯¹æ¯”æ›²çº¿
- `results/plots/RML2016.10a_loss_comparison.png`ï¼šæŸå¤±å¯¹æ¯”æ›²çº¿
- `results/plots/RML2016.10a_combined_comparison.png`ï¼šç»„åˆè§†å›¾ï¼ˆå‡†ç¡®ç‡+æŸå¤±ï¼‰

#### åŠ è½½é¢„è®­ç»ƒæ¨¡å‹

å¦‚æœéœ€è¦åŠ è½½å·²ä¿å­˜çš„æ¨¡å‹æƒé‡è¿›è¡Œæ¨ç†ï¼š

```python
import torch
from FLAlgorithms.trainmodel.models import CNN1D_AMR

# åˆ›å»ºæ¨¡å‹
model = CNN1D_AMR(num_classes=11, signal_length=128)

# åŠ è½½æƒé‡
model.load_state_dict(torch.load('results/RML2016.10a_FedAvg_model.pt'))
model.eval()

# è¿›è¡Œæ¨ç†
with torch.no_grad():
    output = model(input_data)
    predictions = torch.argmax(output, dim=1)
```

---

### 4.4 æ‰¹å¤„ç†è„šæœ¬ï¼ˆä»…é™ Windowsï¼‰

#### å¿«é€Ÿç¤ºä¾‹è„šæœ¬

åŒå‡» `run_example.bat` æˆ–åœ¨å‘½ä»¤è¡Œè¿è¡Œï¼š

```cmd
run_example.bat
```

**åŠŸèƒ½ï¼š** è‡ªåŠ¨è¿è¡Œä¸‰ç§ç®—æ³•å„ 10 è½®è®­ç»ƒ + ç”Ÿæˆå¯¹æ¯”å›¾ã€‚

#### å®Œæ•´å®éªŒè„šæœ¬

åŒå‡» `run_full_experiment.bat` æˆ–åœ¨å‘½ä»¤è¡Œè¿è¡Œï¼š

```cmd
run_full_experiment.bat
```

**åŠŸèƒ½ï¼š** è¿è¡Œä¸‰ç§ç®—æ³•å„ 100 è½®è®­ç»ƒ + ç”Ÿæˆå¯¹æ¯”å›¾ï¼ˆè€—æ—¶è¾ƒé•¿ï¼Œå»ºè®®æœ‰ GPUï¼‰ã€‚

---

### 4.5 å¸¸è§ä½¿ç”¨åœºæ™¯

#### åœºæ™¯ 1ï¼šå¯¹æ¯”ä¸åŒç®—æ³•æ€§èƒ½

```bash
# è¿è¡Œ FedAvg
python main.py --dataset RML2016.10a --algorithm FedAvg --num_rounds 100

# è¿è¡Œ FedProx
python main.py --dataset RML2016.10a --algorithm FedProx --num_rounds 100 --mu 0.01

# è¿è¡Œ FedGen
python main.py --dataset RML2016.10a --algorithm FedGen --num_rounds 100

# ç”Ÿæˆå¯¹æ¯”å›¾
python main_plot.py --dataset RML2016.10a --algorithms FedAvg FedProx FedGen
```

#### åœºæ™¯ 2ï¼šç ”ç©¶ Non-IID å¯¹æ€§èƒ½çš„å½±å“

```bash
# IID åˆ’åˆ†
python main.py --dataset RML2016.10a --algorithm FedAvg --non_iid_type iid

# Non-IID (alpha=0.5)
python main.py --dataset RML2016.10a --algorithm FedAvg --non_iid_type class --alpha 0.5

# Non-IID (alpha=0.1, é«˜åº¦ä¸å‡è¡¡)
python main.py --dataset RML2016.10a --algorithm FedAvg --non_iid_type class --alpha 0.1
```

#### åœºæ™¯ 3ï¼šä¸åŒæ•°æ®é›†ä¸Šçš„å®éªŒ

```bash
# RML2016.10a (11ç±», 128é‡‡æ ·ç‚¹)
python main.py --dataset RML2016.10a --algorithm FedAvg --num_rounds 100

# RML2018a (24ç±», 1024é‡‡æ ·ç‚¹, éœ€è¦æ›´å¤§æ‰¹æ¬¡)
python main.py --dataset RML2018a --algorithm FedAvg --num_rounds 100 --batch_size 64
```

#### åœºæ™¯ 4ï¼šå¯¹æ¯”ä¸åŒä¼˜åŒ–å™¨çš„æ€§èƒ½

```bash
# ä½¿ç”¨ Adam ä¼˜åŒ–å™¨ï¼ˆé»˜è®¤ï¼‰
python main.py --dataset RML2016.10a --algorithm FedAvg --optimizer adam --learning_rate 0.01

# ä½¿ç”¨ SGD ä¼˜åŒ–å™¨ï¼ˆå¸¦åŠ¨é‡ï¼‰
python main.py --dataset RML2016.10a --algorithm FedAvg --optimizer sgd --momentum 0.9 --learning_rate 0.01

# ä½¿ç”¨ AdamW ä¼˜åŒ–å™¨
python main.py --dataset RML2016.10a --algorithm FedAvg --optimizer adamw --learning_rate 0.001

# è°ƒæ•´æƒé‡è¡°å‡
python main.py --dataset RML2016.10a --algorithm FedAvg --optimizer adam --weight_decay 1e-3
```

**è¯´æ˜ï¼š** 
- **Adam**ï¼šè‡ªé€‚åº”å­¦ä¹ ç‡ï¼Œæ”¶æ•›å¿«ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯ï¼ˆ**é»˜è®¤é€‰æ‹©**ï¼‰
- **SGD**ï¼šéœ€è¦ä»”ç»†è°ƒæ•´å­¦ä¹ ç‡ï¼Œä½†æ³›åŒ–èƒ½åŠ›å¼º
- **AdamW**ï¼šAdam çš„æ”¹è¿›ç‰ˆï¼Œæƒé‡è¡°å‡å®ç°æ›´å¥½

---

## 5. é¢„æœŸç»“æœä¸æ€§èƒ½

### è®­ç»ƒæ—¶é—´å‚è€ƒ

**ç¡¬ä»¶ç¯å¢ƒï¼š** RTX 3080 GPU + Intel i7 CPU

| æ•°æ®é›† | ç®—æ³• | 100è½®è®­ç»ƒæ—¶é—´ |
|--------|------|--------------|
| RML2016.10a | FedAvg | çº¦ 20-30 åˆ†é’Ÿ |
| RML2016.10a | FedProx | çº¦ 25-35 åˆ†é’Ÿ |
| RML2016.10a | FedGen | çº¦ 35-45 åˆ†é’Ÿ |
| RML2018a | FedAvg | çº¦ 60-90 åˆ†é’Ÿ |

**CPU è®­ç»ƒæ—¶é—´çº¦ä¸º GPU çš„ 5-10 å€**

### é¢„æœŸå‡†ç¡®ç‡

ä»¥ RML2016.10a æ•°æ®é›†ä¸ºä¾‹ï¼ˆ100è½®è®­ç»ƒï¼Œ10å®¢æˆ·ç«¯ï¼‰ï¼š

| ç®—æ³• | IID | Non-IID (class, alpha=0.5) | Non-IID (SNR) |
|------|-----|---------------------------|---------------|
| FedAvg | 55-65% | 50-60% | 45-55% |
| FedProx | 55-65% | 52-62% | 47-57% |
| FedGen | 50-60% | 48-58% | 43-53% |

**æ³¨æ„ï¼š** å®é™…ç»“æœå—éšæœºç§å­ã€è¶…å‚æ•°è®¾ç½®ã€ç¡¬ä»¶ç¯å¢ƒå½±å“ã€‚

---

## 6. æ•…éšœæ’é™¤ (Troubleshooting)

### é—®é¢˜ 1ï¼šæ‰¾ä¸åˆ°æ•°æ®é›†æ–‡ä»¶

**é”™è¯¯ä¿¡æ¯ï¼š**
```
FileNotFoundError: [Errno 2] No such file or directory: 'dataset/RML2016.10a/RML2016.10a_dict.pkl'
```

**è§£å†³æ–¹æ³•ï¼š**
1. ç¡®è®¤æ•°æ®é›†æ–‡ä»¶å·²ä¸‹è½½
2. æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
3. ç¡®ä¿æ–‡ä»¶åå®Œå…¨åŒ¹é…ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰

### é—®é¢˜ 2ï¼šCUDA å†…å­˜ä¸è¶³

**é”™è¯¯ä¿¡æ¯ï¼š**
```
RuntimeError: CUDA out of memory
```

**è§£å†³æ–¹æ³•ï¼š**
1. å‡å°æ‰¹å¤§å°ï¼š`--batch_size 64` æˆ– `--batch_size 32`
2. å‡å°‘å®¢æˆ·ç«¯æ•°é‡ï¼š`--num_clients 5`
3. ä½¿ç”¨ CPU è®­ç»ƒï¼š`--device cpu`

### é—®é¢˜ 3ï¼šImportError æˆ– ModuleNotFoundError

**è§£å†³æ–¹æ³•ï¼š**
```bash
# é‡æ–°å®‰è£…ä¾èµ–
pip install -r requirements.txt

# ç¡®ä¿åœ¨æ­£ç¡®çš„è™šæ‹Ÿç¯å¢ƒä¸­
conda activate fl_amr
```

### é—®é¢˜ 4ï¼šè®­ç»ƒé€Ÿåº¦éå¸¸æ…¢

**å¯èƒ½åŸå› ï¼š**
- ä½¿ç”¨ CPU è®­ç»ƒï¼ˆæ—  GPUï¼‰
- æ•°æ®é›†è¾ƒå¤§ï¼ˆRML2018aï¼‰

**è§£å†³æ–¹æ³•ï¼š**
1. ä½¿ç”¨ GPUï¼šå®‰è£… CUDA ç‰ˆæœ¬çš„ PyTorch
2. å‡å°‘è®­ç»ƒè½®æ¬¡ï¼š`--num_rounds 50`
3. å¢å¤§æ‰¹å¤§å°ï¼š`--batch_size 256`ï¼ˆå¦‚æœå†…å­˜å…è®¸ï¼‰

---

## 7. è¿›é˜¶ä½¿ç”¨

### è‡ªå®šä¹‰æ•°æ®é›†

å¦‚æœä½ æƒ³ä½¿ç”¨è‡ªå·±çš„æ•°æ®é›†ï¼š

1. åœ¨ `dataset/data_loader.py` ä¸­æ·»åŠ æ–°çš„åŠ è½½å‡½æ•° `load_YourDataset()`
2. åœ¨ `utils/model_config.py` ä¸­æ·»åŠ æ•°æ®é›†é…ç½®
3. ç¡®ä¿æ•°æ®æ ¼å¼ä¸º `[N, 2, L]`

### ä¿®æ”¹æ¨¡å‹æ¶æ„

åœ¨ `FLAlgorithms/trainmodel/models.py` ä¸­å®šä¹‰æ–°çš„æ¨¡å‹ç±»ï¼Œç»§æ‰¿ `nn.Module`ã€‚

### å®ç°æ–°çš„è”é‚¦å­¦ä¹ ç®—æ³•

1. åœ¨ `FLAlgorithms/users/` ä¸­åˆ›å»ºæ–°çš„å®¢æˆ·ç«¯ç±»ï¼ˆç»§æ‰¿ `User`ï¼‰
2. åœ¨ `FLAlgorithms/servers/` ä¸­åˆ›å»ºæ–°çš„æœåŠ¡å™¨ç±»ï¼ˆç»§æ‰¿ `Server`ï¼‰
3. åœ¨ `main.py` ä¸­æ·»åŠ å¯¹åº”çš„åˆå§‹åŒ–é€»è¾‘

---

## 8. é¡¹ç›®æ€»ç»“ (Conclusion)

æœ¬é¡¹ç›®æä¾›äº†ä¸€ä¸ª**å®Œæ•´çš„ã€æ¨¡å—åŒ–çš„ã€æ˜“äºæ‰©å±•çš„**è”é‚¦å­¦ä¹ è‡ªåŠ¨è°ƒåˆ¶è¯†åˆ«ç³»ç»Ÿã€‚é€šè¿‡å®ç°ä¸‰ç§ç»å…¸çš„è”é‚¦å­¦ä¹ ç®—æ³•ï¼ˆFedAvgã€FedProxã€FedGenï¼‰å’Œæ”¯æŒå››ä¸ªæ ‡å‡†æ•°æ®é›†ï¼Œæœ¬é¡¹ç›®å¯ä»¥ä½œä¸ºï¼š

- **æ•™å­¦å·¥å…·**ï¼šå¸®åŠ©åˆå­¦è€…ç†è§£è”é‚¦å­¦ä¹ çš„å·¥ä½œåŸç†
- **ç ”ç©¶å¹³å°**ï¼šä¸ºç ”ç©¶äººå‘˜æä¾›å¯å¤ç°çš„åŸºå‡†å®éªŒ
- **å¼€å‘åŸºç¡€**ï¼šä¸ºå®é™…åº”ç”¨æä¾›å¯æ‰©å±•çš„ä»£ç æ¡†æ¶

### æœªæ¥ä¼˜åŒ–æ–¹å‘

1. **æ€§èƒ½ä¼˜åŒ–**
   - å®ç°å®¢æˆ·ç«¯å¹¶è¡Œè®­ç»ƒï¼ˆå¤šè¿›ç¨‹ï¼‰
   - æ·»åŠ æ··åˆç²¾åº¦è®­ç»ƒï¼ˆFP16ï¼‰
   - ä¼˜åŒ–æ•°æ®åŠ è½½æµç¨‹

2. **åŠŸèƒ½æ‰©å±•**
   - æ·»åŠ æ›´å¤šè”é‚¦å­¦ä¹ ç®—æ³•ï¼ˆFedAdamã€FedNova ç­‰ï¼‰
   - å®ç°å·®åˆ†éšç§æœºåˆ¶
   - æ”¯æŒåŠ¨æ€å®¢æˆ·ç«¯é€‰æ‹©

3. **æ¨¡å‹æ”¹è¿›**
   - å°è¯• Transformer æ¶æ„
   - æ·»åŠ æ³¨æ„åŠ›æœºåˆ¶
   - å®ç°æ¨¡å‹å‹ç¼©æŠ€æœ¯

4. **è¯„ä¼°å¢å¼º**
   - æ·»åŠ æ··æ·†çŸ©é˜µå¯è§†åŒ–
   - å®ç°æ¯ç±»åˆ«å‡†ç¡®ç‡ç»Ÿè®¡
   - è®¡ç®—é€šä¿¡æˆæœ¬åˆ†æ

---

## 9. å‚è€ƒæ–‡çŒ®

å¦‚æœæœ¬é¡¹ç›®å¯¹æ‚¨çš„ç ”ç©¶æœ‰å¸®åŠ©ï¼Œè¯·å¼•ç”¨ä»¥ä¸‹è®ºæ–‡ï¼š

```bibtex
@inproceedings{mcmahan2017fedavg,
  title={Communication-Efficient Learning of Deep Networks from Decentralized Data},
  author={McMahan, Brendan and Moore, Eider and Ramage, Daniel and others},
  booktitle={AISTATS},
  year={2017}
}

@inproceedings{li2020fedprox,
  title={Federated Optimization in Heterogeneous Networks},
  author={Li, Tian and Sahu, Anit Kumar and Zaheer, Manzil and others},
  booktitle={MLSys},
  year={2020}
}

@inproceedings{zhu2021fedgen,
  title={Data-Free Knowledge Distillation for Heterogeneous Federated Learning},
  author={Zhu, Zhuangdi and Hong, Junyuan and Zhou, Jiayu},
  booktitle={ICML},
  year={2021}
}
```

---

## 10. è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- **GitHub Issues**ï¼šåœ¨é¡¹ç›®ä»“åº“æäº¤ Issue
- **Email**ï¼š[å¡«å†™æ‚¨çš„é‚®ç®±]

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼Good Luck with Your Experiments! ğŸš€**

